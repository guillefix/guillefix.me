<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.17" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" href="static.css">
<title>Hamiltonian Monte Carlo: Cosmos — Everything there was, there is, and there will be</title>
</head>
<body class="tc-body">

<section class="tc-story-river">

<p><div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   tc-tagged-Markov%20chain%20Monte%20Carlo " data-tags="[[Markov chain Monte Carlo]]" data-tiddler-title="Hamiltonian Monte Carlo"><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fmore-tiddler-actions" title="More actions"></button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fedit" title="Edit this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible tc-btn-%24%3A%2Fcore%2Fui%2FButtons%2Fclose" title="Close this tiddler"></button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="tiddlymap" class="tc-btn-invisible tc-btn-%24%3A%2Fplugins%2Ffelixhayashi%2Ftiddlymap%2Fmisc%2FquickConnectButton " title="Toggle TiddlyMap actions">


</button></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
Hamiltonian Monte Carlo
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="cosmos.html">
cosmos
</a> 19th March 2017 at 5:02pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"><span class="tc-tag-list-item">


<span class="tc-tag-label tc-btn-invisible" draggable="true" style="background-color:;
fill:#333333;
color:#333333;">
 Markov chain Monte Carlo
</span>

<span class="tc-drop-down tc-reveal" hidden="true"></span>

</span>
</div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Implemented in <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Stan%2520language.html">Stan language</a>.</p><p>Transform unormalized posterior into a <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Hamiltonian.html">Hamiltonian</a>/Energy by <span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo>=</mo><mi>U</mi><mo>(</mo><mi>θ</mi><mo>)</mo><mo>+</mo><mi>K</mi><mo>(</mo><mi>p</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">H=U(\theta)+K(p)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord mathit">p</span><span class="mclose">)</span></span></span></span></span> <span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>=</mo><mo>−</mo><mi>log</mi><mrow><mo>[</mo><mi>p</mi><mo>(</mo><mi>X</mi><mi mathvariant="normal">∣</mi><mi>θ</mi><mo>)</mo><mi>p</mi><mo>(</mo><mi>θ</mi><mo>)</mo><mo>]</mo></mrow><mo>+</mo><mfrac><mrow><msup><mi>p</mi><mi>T</mi></msup><mi>p</mi></mrow><mrow><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">=-\log{[p(X|\theta) p(\theta)]}+\frac{p^T p}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.0418729999999998em;"></span><span class="strut bottom" style="height:1.3868729999999998em;vertical-align:-0.345em;"></span><span class="base textstyle uncramped"><span class="mrel">=</span><span class="mord">−</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mord textstyle uncramped"><span class="mopen">[</span><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.07847em;">X</span><span class="mord mathrm">∣</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mord mathit">p</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mclose">]</span></span><span class="mbin">+</span><span class="mord reset-textstyle textstyle uncramped"><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span><span class="mfrac"><span class="vlist"><span style="top:0.345em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathrm">2</span></span></span></span><span style="top:-0.22999999999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle textstyle uncramped frac-line"></span></span><span style="top:-0.44610799999999995em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord scriptstyle uncramped"><span class="mord"><span class="mord mathit">p</span><span class="vlist"><span style="top:-0.363em;margin-right:0.07142857142857144em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-scriptstyle scriptscriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mord mathit">p</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="sizing reset-size5 size5 reset-textstyle textstyle uncramped nulldelimiter"></span></span></span></span></span></span>.</p><p>For each iteration:</p><dl><dd>Give a random momentum to each of an ensemble of particles, then making it evolve according to <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Hamiltonian%2520dynamics.html">Hamiltonian dynamics</a> for some period of time (which means it should approach the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Boltzmann%2520distribution.html">Boltzmann distribution</a>), and then accept new position according to an acceptance rule, like that of the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Metropolis-Hastings%2520algorithm.html">Metropolis-Hastings algorithm</a>, which is that we accept if <span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mrow><mtext><mi mathvariant="normal">f</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mtext></mrow></msub><mo>&gt;</mo><msub><mi>H</mi><mrow><mtext><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mtext></mrow></msub></mrow><annotation encoding="application/x-tex">H_{\text{final}} &gt; H_{\text{initial}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="text mord scriptstyle cramped"><span class="mord mathrm" style="margin-right:0.07778em;">f</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span><span class="mrel">&gt;</span><span class="mord"><span class="mord mathit" style="margin-right:0.08125em;">H</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.08125em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="text mord scriptstyle cramped"><span class="mord mathrm">i</span><span class="mord mathrm">n</span><span class="mord mathrm">i</span><span class="mord mathrm">t</span><span class="mord mathrm">i</span><span class="mord mathrm">a</span><span class="mord mathrm">l</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">​</span></span>​</span></span></span></span></span></span></span>, and otherwise we use the <a class="tc-tiddlylink tc-tiddlylink-resolves" href="Boltzmann%2520distribution.html">Boltzmann distribution</a> as the probability of accepting.</dd></dl><p>This basically uses as its <a class="tc-tiddlylink tc-tiddlylink-missing" href="Proposal%2520distribution.html">Proposal distribution</a> something that in expectation/asympotically is the Boltzmann distribution. As said <a class="tc-tiddlylink-external" href="http://www.inference.phy.cam.ac.uk/mackay/itprnn/ps/387.412.pdf" rel="noopener noreferrer" target="_blank">here</a>, if the Hamiltonian dynamics simulation is perfect, the acceptance rule always accept because <span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.08125em;">H</span></span></span></span></span> is conserved. However, if we assume that the simulation does random errors such  that the distribution of errors is proportional to the Boltzmann distro, then we put this distro in the acceptance rule, so that it cancels out in the stationary distribution. However, <mark>How do we know that the random errors such  that the distribution of errors is proportional to the Boltzmann distribution?<mark><p><a class="tc-tiddlylink-external" href="http://arogozhnikov.github.io/2016/12/19/markov_chain_monte_carlo.html" rel="noopener noreferrer" target="_blank">Hamiltonian Monte Carlo explained</a></p><p><a class="tc-tiddlylink-external" href="http://www.inference.phy.cam.ac.uk/mackay/itprnn/ps/387.412.pdf" rel="noopener noreferrer" target="_blank">McKay's book chapter</a></p><p><a class="tc-tiddlylink-external" href="https://arxiv.org/pdf/1206.1901.pdf" rel="noopener noreferrer" target="_blank">another book chapter</a></p><hr><p><a class="tc-tiddlylink-external" href="https://www.youtube.com/watch?v=VnNdhsm0rJQ" rel="noopener noreferrer" target="_blank">Scalable Bayesian Inference with Hamiltonian Monte Carlo</a></p><p><a class="tc-tiddlylink-external" href="https://www.youtube.com/watch?v=pHsuIaPbNbY&amp;t=2s" rel="noopener noreferrer" target="_blank">Efficient Bayesian inference with Hamiltonian Monte Carlo -- Michael Betancourt (Part 1)</a></p></mark></mark></p></div>


</div>

</p>

</section>
</body>
</html>
